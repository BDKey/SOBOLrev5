# SOBOL-0 REV-5
Начало создания: 15.03.2024
Дата выхода: 13.12.2024

## Быстрый старт
Запустите схему через [Logisim-evolution](https://github.com/logisim-evolution/logisim-evolution)

## Основы архитектуры
Архитектура микрокомпьютера SOBOL REV-5 разработана в 2024 году и имеет в себе набор из 63 команд, которые выполняются за один полный ход тактового генератора. В состав набора команд входят: команды сложения и вычитания, команды логических операций, команды условного и безусловного перехода, арифметический и логические сдвиги. Команды могут устанавливать отдельные биты в флаговом регистре. Также имеется поддержка watchdog таймера и внешних переключателей для байта К8.
Наборы регистров и I/O порты
Регистр содержит ровно байт информации, может записывать в себя значения, а также выводить его на две шины данных. Основными являются 32 регистра общего назначения, после них идёт 2 регистра адресации RAM и регистр для таймера watchdog. Остальные 221 из 256 возможных подключений по I/O полностью свободны и могут быть адресованы из программы. К шине можно подключить любое устройство, которое будет подходить по параметрам, то есть получать байт на вход и выдавать байт на выход.
## Флаги
В SOBOL применяются флаги для отслеживания состояния, также некоторых вычислений. Всего бит в регистре SREG – 8:
-	I – флаг разрешения прерываний
-	T – пользовательский флаг
-	H – флаг полу-переноса
-	S – флаг знака (V XOR N)
-	V – флаг переполнения дополнительного кода
-	N – флаг отрицательного значения
-	Z – флаг нуля
-	C – флаг переноса

Флаги устанавливаются в соответствии результатов исполнения некоторых команд, если необходимо. Подробнее с изменениями флагов можно ознакомиться в таблице № 1.
Чтобы установить флаг в какое-либо значение нужно подать 1 на дорожку для активации записи соответствующего флага и желаемое значение на дорожку значения. Третья дорожка отвечает за текущее значение регистра, что используется некоторыми командами.
## Устройство ПЗУ
В SOBOL для работы используются инструкции длинной 4 байта (32 бита), где:
-	1-й байт отвечает за номер команды
-	2-й байт отвечает за адрес первого регистра, слово (для тех команд, которые используют слова) или же номер бита в флаговом регистре SREG
-	3-й байт отвечает за адрес второго регистра
-	4-й байт отвечает за адрес результатного регистра
Для навигации по ПЗУ используется основной счётчик PC, который может переходить по адресу записанный в прыжковые регистры через команды SJR и SJRW (подробнее в таблице № 1).
## Watchdog таймер
В устройстве SOBOL предусмотрен таймер Watchdog для избежания бесконечных циклов или для использования прерываний через время. Для того, чтобы происходил отсчёт нужно записать в регистр по адресу 34 количество циклов до прерывания и установить флаг I в 1. После срабатывания счётчик PC сбросится в нулевое положение без очистки памяти.
## ОЗУ и стек
В SOBOL находится 64 Кбайт ОЗУ, для доступа к которым используются команды LD и ST.
Также предусмотрен пользовательский стек, доступный с помощью команд PUSH и POP.
## Функции
В SOBOL предусмотрены аппаратно реализованные функции. RCALL и CALL – для вызова функций. При их вызове текущее значение PC счётчика записывается в отдельный стек и происходит переход на указанный адрес (фактический или рекурсивный). Для возврата используется функция RET, которая переходит по последнему адресу в стеке. Максимальная вложенность – 255.
## Шины
Основными шинами в архитектуре представлены:
-	Шина программы – 4 байта из ПЗУ
-	Шина данных – данные из регистров общего назначения
-	Шина результата – результат из процессора и адрес записи
-	Шина ввода/вывода – Данные для ввода и вывода и импульсы на чтение и запись
## К8
К8 – постоянный байт, задающиеся переключателями или иными устройствами, использующиеся в команде ADIW.
Регистр подготовки
Для инициализации SOBOL используется особый регистр – регистр подготовки.
После перезапуска (или же включения) первый ход тактового генератора пропускается, так как регистр подготовки изначально установлен в 0, а также используется для сброса и инициализации регистров, счётчиков и им подобным, вместе с этим регистр подготовки устанавливается в 1. После этого работа продолжается в обычном режиме.
